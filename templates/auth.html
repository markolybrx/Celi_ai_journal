<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Celi: Access Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --mood: #00f2fe; }
        body { background: #000; color: #fff; font-family: sans-serif; height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; }
        
        /* GLASS CONTAINER */
        .glass-panel { width: 90%; max-width: 380px; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 24px; padding: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); position: relative; overflow: hidden; transition: height 0.3s ease; }
        .input-group { margin-bottom: 15px; position: relative; }
        .input-field { width: 100%; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 12px 15px; color: #fff; font-size: 13px; outline: none; transition: border-color 0.3s; }
        .input-field:focus { border-color: var(--mood); }
        .input-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: rgba(255, 255, 255, 0.5); margin-bottom: 6px; display: block; }
        .btn-primary { width: 100%; padding: 14px; background: var(--mood); color: #000; border-radius: 12px; font-weight: 900; text-transform: uppercase; font-size: 11px; letter-spacing: 1px; cursor: pointer; transition: transform 0.2s; border: none; margin-top: 10px; }
        .btn-primary:active { transform: scale(0.98); }
        .btn-secondary { width: 100%; padding: 14px; background: rgba(255, 255, 255, 0.05); color: #fff; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; font-weight: bold; text-transform: uppercase; font-size: 10px; cursor: pointer; margin-top: 10px; }
        .hidden { display: none; }
        .text-link { color: var(--mood); cursor: pointer; text-decoration: underline; }
        .eye-icon { position: absolute; right: 12px; top: 38px; width: 16px; height: 16px; opacity: 0.5; cursor: pointer; }
        .color-dot { width: 20px; height: 20px; border-radius: 50%; position: absolute; right: 12px; top: 35px; border: 1px solid rgba(255,255,255,0.2); }
        
        #loading-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 50; display: none; align-items: center; justify-content: center; flex-direction: column; }
        .spinner { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1); border-top-color: var(--mood); border-radius: 50%; animation: spin 1s infinite linear; margin-bottom: 15px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        #privacy-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; display: none; align-items: center; justify-content: center; padding: 20px; }
        .privacy-box { background: #111; border: 1px solid rgba(255,255,255,0.1); padding: 30px; border-radius: 20px; max-width: 500px; max-height: 80vh; overflow-y: auto; color: #ccc; font-size: 12px; line-height: 1.6; }
    </style>
</head>
<body>

    <div class="glass-panel" id="auth-container">
        <div id="loading-overlay"><div class="spinner"></div><p id="loading-text" class="text-xs uppercase tracking-widest text-white/80">Processing...</p></div>

        <div id="view-login">
            <h1 class="text-3xl font-black text-center mb-8 tracking-tighter text-white">Celi</h1>
            <form onsubmit="handleLogin(event)">
                <div class="input-group"><label class="input-label">Username</label><input type="text" name="username" class="input-field" placeholder="Traveler" required></div>
                <div class="input-group"><label class="input-label">Password</label><input type="password" name="password" id="login-pass" class="input-field" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required><div class="eye-icon" onclick="togglePass('login-pass')">üëÅÔ∏è</div></div>
                <button type="submit" class="btn-primary">Log In</button>
            </form>
            <button onclick="switchView('register')" class="btn-secondary">Register New Signal</button>
        </div>

        <div id="view-register" class="hidden">
            <h1 class="text-xl font-bold text-center mb-6 uppercase tracking-widest text-white/90">Access Registration</h1>
            <form onsubmit="handleRegister(event)">
                <div class="flex gap-2 mb-2"><div class="w-1/2"><label class="input-label">First Name</label><input type="text" name="fname" class="input-field" required></div><div class="w-1/2"><label class="input-label">Last Name</label><input type="text" name="lname" class="input-field" required></div></div>
                <div class="input-group"><label class="input-label">Preferred Username</label><input type="text" name="reg_username" class="input-field" required></div>
                <div class="input-group"><label class="input-label">Date of Birth</label><input type="date" name="dob" class="input-field" required></div>
                <div class="input-group"><label class="input-label">Favorite Color</label><input type="text" id="color-input" name="fav_color" class="input-field" placeholder="Cyan, Gold, Purple..." oninput="updateColorPreview(this.value)"><div id="color-preview" class="color-dot" style="background-color: #00f2fe;"></div></div>
                <div class="input-group"><label class="input-label">Password</label><input type="password" name="reg_password" id="reg-pass" class="input-field" required><div class="eye-icon" onclick="togglePass('reg-pass')">üëÅÔ∏è</div></div>
                <div class="input-group"><label class="input-label">Confirm Password</label><input type="password" id="confirm-pass" class="input-field" oninput="checkMatch()" required></div>
                <div class="flex items-start gap-3 my-4"><input type="checkbox" id="privacy-check" required class="mt-1"><label for="privacy-check" class="text-[10px] opacity-70 leading-tight">I agree to the <span class="text-link" onclick="openPrivacy()">Data Privacy Disclosure</span>. I understand my data is stored securely.</label></div>
                <button type="submit" class="btn-primary">Register</button>
            </form>
            <button onclick="switchView('login')" class="btn-secondary">Already have an account?</button>
        </div>
    </div>

    <div class="fixed bottom-4 w-full text-center pointer-events-none opacity-20 text-[9px] font-mono uppercase tracking-widest text-white">Celi Access v1.5.1</div>

    <div id="privacy-modal"><div class="privacy-box"><h2 class="text-xl font-bold mb-4 uppercase text-white">Data Privacy Disclosure</h2><p class="mb-3"><strong>1. Data Storage:</strong> Celi uses a secure, encrypted cloud database (MongoDB Atlas) to store your journal entries, rank progress, and user preferences.</p><p class="mb-3"><strong>2. AI Processing:</strong> Your journal entries are processed ephemerally by our AI provider (Google Gemini) solely to generate responses.</p><p class="mb-3"><strong>3. Sovereignty:</strong> You retain full ownership of your data.</p><button onclick="document.getElementById('privacy-modal').style.display='none'" class="btn-primary">I Understand</button></div></div>

    <script>
        function switchView(view) { document.getElementById('view-login').classList.add('hidden'); document.getElementById('view-register').classList.add('hidden'); document.getElementById('view-' + view).classList.remove('hidden'); }
        function togglePass(id) { const el = document.getElementById(id); el.type = el.type === 'password' ? 'text' : 'password'; }
        function updateColorPreview(val) { const s = new Option().style; s.color = val; if (s.color !== '') { document.getElementById('color-preview').style.backgroundColor = val; } }
        function checkMatch() { const p1 = document.getElementById('reg-pass').value; const p2 = document.getElementById('confirm-pass'); p2.style.borderColor = p2.value !== p1 ? 'red' : 'rgba(255,255,255,0.1)'; }
        function openPrivacy() { document.getElementById('privacy-modal').style.display = 'flex'; }
        function showLoading(msg) { document.getElementById('loading-text').innerText = msg; document.getElementById('loading-overlay').style.display = 'flex'; }

        async function handleLogin(e) {
            e.preventDefault(); showLoading("Logging you in...");
            const form = new FormData(e.target);
            setTimeout(async () => {
                const res = await fetch('/login', { method: 'POST', body: form });
                if (res.ok) { window.location.href = '/'; } else { alert("Access Denied."); document.getElementById('loading-overlay').style.display = 'none'; }
            }, 1000);
        }

        async function handleRegister(e) {
            e.preventDefault();
            if(document.getElementById('reg-pass').value !== document.getElementById('confirm-pass').value) { alert("Passwords do not match."); return; }
            showLoading("Registering Identity...");
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            setTimeout(async () => {
                const res = await fetch('/api/register', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
                if (res.ok) { alert("Registration Complete."); document.getElementById('loading-overlay').style.display = 'none'; switchView('login'); } else { const err = await res.json(); alert("Error: " + (err.error || "Failed")); document.getElementById('loading-overlay').style.display = 'none'; }
            }, 1500);
        }
    </script>
</body>
</html>
