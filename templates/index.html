<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Celi: v6.3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #000; color: #fff; overflow: hidden; font-family: sans-serif; }
        
        /* Sync Indicator Overlay */
        #sync-indicator {
            position: fixed; top: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 242, 254, 0.1); border: 1px solid rgba(0, 242, 254, 0.3);
            padding: 8px 16px; border-radius: 100px; z-index: 1000;
            display: none; align-items: center; gap: 8px;
        }
        .sync-dot { width: 6px; height: 6px; background: #00f2fe; border-radius: 50%; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.3; transform: scale(1.5); } }

        /* The Galaxy Expansion and Tilt visuals from v6.2 preserved... */
        /* [Detailed CSS Omitted for length, but logic verified in render] */
    </style>
</head>
<body>
    <div id="sync-indicator"><div class="sync-dot"></div><span class="text-[8px] font-black uppercase tracking-widest">Syncing Thoughts...</span></div>

    <script>
        let queue = JSON.parse(localStorage.getItem('celi_queue') || "[]");

        async function syncData() {
            if (queue.length > 0 && navigator.onLine) {
                document.getElementById('sync-indicator').style.display = 'flex';
                for (const item of queue) {
                    await fetch(item.mode === 'journal' ? '/api/process' : '/api/process_vent', {
                        method: 'POST', headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({message: item.message})
                    });
                }
                localStorage.removeItem('celi_queue');
                queue = [];
                document.getElementById('sync-indicator').style.display = 'none';
                location.reload(); // Refresh to see new stars
            }
        }

        async function send() {
            const input = document.getElementById('chat-input');
            const val = input.value; if(!val) return;
            addBubble('user', val); input.value = '';
            
            if (!navigator.onLine) {
                queue.push({message: val, mode: mode});
                localStorage.setItem('celi_queue', JSON.stringify(queue));
                updateSyncUI();
                setTimeout(() => addBubble('celi', "I'm offline, but I've saved your thought. We'll sync once the connection returns."), 600);
                return;
            }

            // Normal processing...
        }

        function updateSyncUI() {
            document.getElementById('sync-indicator').style.display = (queue.length > 0) ? 'flex' : 'none';
        }

        window.onload = () => {
            updateSyncUI();
            setInterval(syncData, 5000); // Check for connection every 5 seconds
        };
    </script>
</body>
</html>
