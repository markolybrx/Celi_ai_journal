<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Celi | AI Journal</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white p-5 font-sans">

    <div id="setup" class="fixed inset-0 bg-black z-50 p-10">
        <h1 class="text-xs tracking-widest text-gray-500 mb-5">SYSTEM START</h1>
        <button onclick="initApp()" class="w-full bg-indigo-600 p-5 rounded-xl font-bold">ACTIVATE MIRROR</button>
        <p class="text-[10px] text-gray-600 mt-5 text-center">Note: Use Safari or Chrome. Must be HTTPS.</p>
    </div>

    <div class="flex flex-col h-[90dvh]">
        <div id="chat-box" class="flex-grow overflow-y-auto space-y-4 pt-10">
            <p class="text-indigo-400 text-sm italic">Mirror active. Speak.</p>
        </div>
        
        <div class="mt-auto flex gap-2">
            <input id="user-input" class="flex-grow bg-gray-900 border border-gray-800 p-4 rounded-xl" placeholder="Type here...">
            <button onclick="sendMsg()" class="bg-indigo-600 px-6 rounded-xl font-bold">GO</button>
        </div>
    </div>

    <script>
        let vault = { name: "User" };

        function initApp() {
            document.getElementById('setup').style.display = 'none';
        }

        async function sendMsg() {
            const i = document.getElementById('user-input');
            const box = document.getElementById('chat-box');
            const val = i.value;
            if(!val) return;

            box.innerHTML += `<p class="text-gray-500">YOU: ${val}</p>`;
            i.value = '';

            try {
                const response = await fetch('/api/process', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ message: val, profile: vault })
                });
                
                const data = await response.json();
                box.innerHTML += `<p class="text-white">CELI: ${data.reply}</p>`;
                box.scrollTop = box.scrollHeight;
            } catch (e) {
                box.innerHTML += `<p class="text-red-500">ERROR: Could not reach server. Check Render Logs.</p>`;
            }
        }
    </script>
</body>
</html>
